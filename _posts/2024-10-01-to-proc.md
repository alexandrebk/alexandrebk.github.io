---
layout: post
title:  "Les procs"
description: "Les procs"
seo_description: "Les procs"
difficulty: 1
status: tech
---

Dans ce tuto nous allons apprendre à utiliser un proc.

### Première étape

Dans une <a href="https://www.youtube.com/watch?v=qdbS-qJOOeA&ab_channel=RubyCademy" class="underlined" target="_blank">vidéo Youtube</a>

```ruby
data = [{email: 'toto@gmail.com'}, {email: 'titi@gmail.com'}]

User = Struct.new(:email, keyword_init: true)

class UserBuilder
  def initialize(data)
    @data = data
  end

  def build
    User.new(@data)
  end

  def self.to_proc
    Proc.new {|data| new(data).build }
  end
end
```

Il existe deux manières de créer des nouveaux utilisateurs qui sont similaires en termes de résultats.

```ruby
data.map { |user_data| UserBuilder.new(user_data).build }
# [#<struct User email="toto@gmail.com">, #<struct User email="titi@gmail.com">]
data.map(&UserBuilder)
# [#<struct User email="toto@gmail.com">, #<struct User email="titi@gmail.com">]
```

Dans la seconde façon nous avons utilisé un proc appelé avec un esperluette.

### Que fait l'esperluette ?

```ruby
data.map(&Builders::User)
```

Tout d'abord il faut savoir qu'un esperluette qui est passé en argument d'un énumérator va appeler par défaut la méthode `to_proc` sur l'argument. Dans notre cas le `Builders::User`.

### Qu'est ce qu'un proc ?

Ensuite la méthode to_proc va retourner un proc qui est un block de code.

Un proc est une instance de la classe `Proc`. C’est un objet qui peut être lié à une variable et réutilisé. Il se définit en appelant Proc.new ou proc suivi d’un block. Un proc va pouvoir récupérer des arguments pour les traiter.

Dans notre exemple il récupère le Hash avec les data des users pour ensuite instantier le builder et appeler la méthode build.

Pour aller plus loin sur les procs, il y'a <a href="https://medium.com/rubycademy/mastering-the-unary-ampersand-operator-with-blocks-cb5a48aca175" class="underlined" target="_blank">cet excellent article</a> toujours de RubyCademy.



